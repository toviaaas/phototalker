<script>
  const SERVER_URL =
    "https://a5a053cc-03e2-414c-a64a-520d65f47721-00-2z9hwcnumj4e3.sisko.replit.dev";

  const fileInput = document.getElementById("file-input");
  const previewImg = document.getElementById("preview-img");
  const bubble = document.getElementById("bubble");

  fileInput.addEventListener("change", (e) => {
    const file = e.target.files[0];
    if (file) {
      previewImg.src = URL.createObjectURL(file);
      previewImg.style.display = "block";
    }
  });

  async function register() {
    const styleOption = document.querySelector("input[name='style']:checked").value;
    const file = fileInput.files[0];

    if (!file) {
      alert("이미지를 선택하세요!");
      return;
    }

    const formData = new FormData();
    formData.append("style", styleOption);
    formData.append("image", file);

    try {
      const response = await fetch(`${SERVER_URL}/generate_caption`, {
        method: "POST",
        body: formData,
      });

      const result = await response.json();
      console.log("AI Response:", result);

      bubble.innerText = result.caption || "응답 데이터 없음";
      bubble.style.display = "block";
    } catch (err) {
      console.error(err);
      bubble.innerText = "서버 연결 오류 – 서버야..일해라.";
      bubble.style.display = "block";
    }
  }
</script>

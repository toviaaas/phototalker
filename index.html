<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>í¬í† í† ì»¤ (PhotoTalker)</title>

<style>
  body {
    font-family: 'Pretendard', sans-serif;
    background: #f0f0f0;
    margin: 0;
    padding: 30px;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  h1 {
    font-size: 38px;
    font-weight: 900;
    margin-bottom: 10px;
  }

  .upload-area {
    border: 4px dashed black;
    width: 600px;
    height: 200px;
    display: flex;
    justify-content: center;
    align-items: center;
    background: white;
    cursor: pointer;
    font-size: 18px;
    margin-bottom: 25px;
    text-align: center;
  }

  .panel {
    border: 6px solid black;
    padding: 20px;
    margin-top: 10px;
    background: white;
    height: 500px;
    width: 600px;
    position: relative;
    overflow: hidden;
  }

  #preview {
    display: none;
    position: absolute;
    bottom: 10px;
    left: 10px;
    max-width: 55%;
    max-height: 430px;
    object-fit: contain;
  }

  .speech-bubble {
    position: absolute;
    top: 20px;
    right: 20px;
    max-width: 40%;
    min-width: 200px;
    min-height: 80px;
    padding: 20px 25px;
    font-weight: 700;
    word-wrap: break-word;
    overflow-wrap: break-word;
    display: none;
    text-align: center;
    border: 4px solid black;
    border-radius: 18px;
    background: white;
  }

  button {
    padding: 12px 22px;
    font-size: 18px;
    font-weight: 700;
    border: 4px solid black;
    background: white;
    cursor: pointer;
    margin-top: 15px;
  }
</style>
</head>

<body>
  <h1>í¬í† í† ì»¤ (PhotoTalker)</h1>
  <p>ì‚¬ì§„ì´ ì§ì ‘ ë§í•œë‹¤ â€“ ì›ƒê¸´ ë²„ì „ë¶€í„° íŒíƒ€ì§€ ë²„ì „ê¹Œì§€!</p>

  <div class="upload-area" onclick="document.getElementById('inputImage').click()">
    ğŸ“¸ ì‚¬ì§„ ì—…ë¡œë“œ<br>(Click to upload or Drag & Drop)
  </div>
  <input type="file" id="inputImage" accept="image/*" style="display:none;">

  <label><input type="radio" name="style" value="funny"> ì›ƒê¹€</label>
  <label><input type="radio" name="style" value="fantasy"> íŒíƒ€ì§€</label>
  <label><input type="radio" name="style" value="random" checked> ëœë¤</label>

  <button onclick="register()">ğŸª„ ëŒ€ì‚¬ ìƒì„±í•˜ê¸°</button>

  <div class="panel">
    <img id="preview"/>
    <div id="bubble" class="speech-bubble"></div>
  </div>

<script>
  const inputImg = document.getElementById("inputImage");
  const preview = document.getElementById("preview");
  const bubble = document.getElementById("bubble");

  // ì´ë¯¸ì§€ ì„ íƒ ì‹œ ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ
  inputImg.addEventListener("change", function() {
    const file = this.files[0];
    if (!file) return;
    preview.src = URL.createObjectURL(file);
    preview.style.display = "block";
    bubble.style.display = "none";
  });

  // ì„œë²„ ìš”ì²­
  async function register() {
    const file = inputImg.files[0];
    if (!file) {
      alert("ì‚¬ì§„ì„ ë¨¼ì € ì—…ë¡œë“œí•´ì£¼ì„¸ìš”!");
      return;
    }

    const styleOption = document.querySelector("input[name='style']:checked").value;

    const formData = new FormData();
    formData.append("image", file);
    formData.append("style", styleOption);

    bubble.innerText = "â³ ìƒì„± ì¤‘...";
    bubble.style.display = "block";

    try {
      const res = await fetch(
        "https://c7978a8f-719a-4e66-ab9d-f5fec0b7e03b-00-gxdzr6bxktq2.sisko.replit.dev/generate_caption",
        {
          method: "POST",
          body: formData
        }
      );

      // ì„œë²„ê°€ ì œëŒ€ë¡œ ì‘ë‹µ ëª»í•˜ë©´ ì—¬ê¸°ì„œ ì—ëŸ¬ë‚¨
      const data = await res.json();

      // ë°±ì—”ë“œ êµ¬ì¡°ê°€ caption í‚¤ë¼ê³  ê°€ì •
      bubble.innerText = data.caption || "â— ì‘ë‹µ ì˜¤ë¥˜: ì„œë²„ê°€ ë¬¸ì¥ì„ ë³´ë‚´ì§€ ì•Šì•˜ì–´ìš”";

    } catch (err) {
      console.error("ERROR:", err);
      bubble.innerText = "âš ï¸ ì„œë²„ì—ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤!";
    }
  }
</script>

</body>
</html>
